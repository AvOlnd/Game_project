def on_update(self, delta_time):
    self.game_time += delta_time
    
    self.level = 1 + int(self.game_time // 30)
    
    if self.left_pressed and not self.right_pressed:
        self.player_sprite.center_x -= PLAYER_SPEED
    if self.right_pressed and not self.left_pressed:
        self.player_sprite.center_x += PLAYER_SPEED
    
    if self.player_sprite.center_x < self.player_sprite.width // 2:
        self.player_sprite.center_x = self.player_sprite.width // 2
    if self.player_sprite.center_x > SCREEN_WIDTH - self.player_sprite.width // 2:
        self.player_sprite.center_x = SCREEN_WIDTH - self.player_sprite.width // 2
    
    if self.space_pressed and self.can_shoot:
        if len(self.bullet_list) < 15:
            bullet = Bullet(
                self.player_sprite.center_x,
                self.player_sprite.center_y + self.player_sprite.height // 2
            )
            self.bullet_list.append(bullet)
            self.can_shoot = False
            self.shoot_timer = self.shoot_delay
    
    if not self.can_shoot:
        self.shoot_timer -= 1
        if self.shoot_timer <= 0:
            self.can_shoot = True
    
    self.bullet_list.update()
    
    for bullet in self.bullet_list:
        if bullet.center_y > SCREEN_HEIGHT + 20:
            bullet.remove_from_sprite_lists()
    
    self.asteroid_list.update()
    
    if random.random() < 0.02 + self.level * 0.005:
        if len(self.asteroid_list) < ASTEROID_COUNT * 2:
            asteroid = Asteroid(random.randint(30, 60), self.level)
            self.asteroid_list.append(asteroid)
    
    for bullet in self.bullet_list:
        hit_list = arcade.check_for_collision_with_list(bullet, self.asteroid_list)
        if hit_list:
            bullet.remove_from_sprite_lists()
            for asteroid in hit_list:
                asteroid.health -= 1
                if asteroid.health <= 0:
                    self.score += 10
                    self.asteroids_destroyed += 1
                    asteroid.remove_from_sprite_lists()
                    
                    for _ in range(15):
                        particle = Particle(
                            asteroid.center_x,
                            asteroid.center_y,
                            "orange"
                        )
                        self.particles.append(particle)
    
    if self.player_sprite.invulnerable <= 0:
        hit_list = arcade.check_for_collision_with_list(self.player_sprite, self.asteroid_list)
        if hit_list:
            self.player_sprite.health -= 20
            self.player_sprite.invulnerable = 60
            for asteroid in hit_list:
                asteroid.remove_from_sprite_lists()
                
                for _ in range(10):
                    particle = Particle(
                        asteroid.center_x,
                        asteroid.center_y,
                        "red"
                    )
                    self.particles.append(particle)
    
    for particle in self.particles[:]:
        particle.x += particle.vx
        particle.y += particle.vy
        particle.age += delta_time
        
        if particle.age >= particle.life:
            self.particles.remove(particle)
    
    self.player_sprite.update()
    
    if self.player_sprite.health <= 0:
        self.window.save_high_score(self.score)
        game_over_view = GameOverView(self.score, self.level, self.asteroids_destroyed, int(self.game_time))
        self.window.show_view(game_over_view)

def on_key_press(self, key, modifiers):
    if key == arcade.key.LEFT:
        self.left_pressed = True
    elif key == arcade.key.RIGHT:
        self.right_pressed = True
    elif key == arcade.key.SPACE:
        self.space_pressed = True
    elif key == arcade.key.ESCAPE:
        menu_view = GameMenu()
        self.window.show_view(menu_view)


def on_key_release(self, key, modifiers):
    if key == arcade.key.LEFT:
        self.left_pressed = False
    elif key == arcade.key.RIGHT:
        self.right_pressed = False
    elif key == arcade.key.SPACE:
        self.space_pressed = False
