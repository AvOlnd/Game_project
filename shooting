import arcade
import math

SCREEN_WIDTH = 800
SCREEN_HEIGHT = 600
SCREEN_TITLE = "Демоверсия стрельба спрайта"
PLAYER_SPEED = 5
BULLET_SPEED = 10
PLAYER_SCALE = 0.5
BULLET_SCALE = 0.2

class Bullet(arcade.Sprite):
    def __init__(self, image, scale, speed, angle):
        super().__init__(image, scale)
        self.speed = speed
        self.change_x = math.cos(math.radians(angle)) * speed
        self.change_y = math.sin(math.radians(angle)) * speed
        
    def update(self):
        self.center_x += self.change_x
        self.center_y += self.change_y
        
        if (self.center_x < 0 or self.center_x > SCREEN_WIDTH or
            self.center_y < 0 or self.center_y > SCREEN_HEIGHT):
            self.remove_from_sprite_lists()

class Player(arcade.Sprite):
    def __init__(self, image, scale):
        super().__init__(image, scale)
        self.bullet_list = arcade.SpriteList()

class MyGame(arcade.Window):
    def __init__(self):
        super().__init__(SCREEN_WIDTH, SCREEN_HEIGHT, SCREEN_TITLE)
        
        self.player_sprite = None
        self.bullet_list = None
        
        self.player_texture = None
        self.bullet_texture = None
        
        self.left_pressed = False
        self.right_pressed = False
        self.up_pressed = False
        self.down_pressed = False
        
        arcade.set_background_color(arcade.color.AMAZON)
    
    def setup(self):
        self.player_sprite = Player(":resources:images/animated_characters/female_person/femalePerson_idle.png", 
                                   PLAYER_SCALE)
        self.player_sprite.center_x = SCREEN_WIDTH // 2
        self.player_sprite.center_y = SCREEN_HEIGHT // 2
        
        self.bullet_list = arcade.SpriteList()
        
        self.bullet_texture = arcade.load_texture(":resources:images/space_shooter/laserBlue01.png")
    
    def on_draw(self):
        self.clear()
        self.player_sprite.draw()
        self.bullet_list.draw()
        
        arcade.draw_text(f"Пулей: {len(self.bullet_list)}", 
                        10, SCREEN_HEIGHT - 30, arcade.color.WHITE, 18)
        arcade.draw_text("WASD - движение, ЛКМ - стрельба", 
                        10, SCREEN_HEIGHT - 60, arcade.color.WHITE, 14)
    
    def on_update(self, delta_time):
        self.player_sprite.change_x = 0
        self.player_sprite.change_y = 0
        
        if self.up_pressed and not self.down_pressed:
            self.player_sprite.change_y = PLAYER_SPEED
        elif self.down_pressed and not self.up_pressed:
            self.player_sprite.change_y = -PLAYER_SPEED
        if self.left_pressed and not self.right_pressed:
            self.player_sprite.change_x = -PLAYER_SPEED
        elif self.right_pressed and not self.left_pressed:
            self.player_sprite.change_x = PLAYER_SPEED
        
        self.player_sprite.update()
        
        self.bullet_list.update()
    
    def on_mouse_press(self, x, y, button, modifiers):
        if button == arcade.MOUSE_BUTTON_LEFT:
            bullet = Bullet(":resources:images/space_shooter/laserBlue01.png", 
                          BULLET_SCALE, BULLET_SPEED, 0)
            
            bullet.center_x = self.player_sprite.center_x
            bullet.center_y = self.player_sprite.center_y
            
            x_diff = x - self.player_sprite.center_x
            y_diff = y - self.player_sprite.center_y
            angle = math.degrees(math.atan2(y_diff, x_diff))
            
            bullet.angle = angle
            bullet.change_x = math.cos(math.radians(angle)) * BULLET_SPEED
            bullet.change_y = math.sin(math.radians(angle)) * BULLET_SPEED
            
            self.bullet_list.append(bullet)
    
    def on_key_press(self, key, modifiers):
        if key == arcade.key.W:
            self.up_pressed = True
        elif key == arcade.key.S:
            self.down_pressed = True
        elif key == arcade.key.A:
            self.left_pressed = True
        elif key == arcade.key.D:
            self.right_pressed = True
        elif key == arcade.key.ESCAPE:
            arcade.close_window()
    
    def on_key_release(self, key, modifiers):
        if key == arcade.key.W:
            self.up_pressed = False
        elif key == arcade.key.S:
            self.down_pressed = False
        elif key == arcade.key.A:
            self.left_pressed = False
        elif key == arcade.key.D:
            self.right_pressed = False

def main():
    window = MyGame()
    window.setup()
    arcade.run()

if __name__ == "__main__":
    main()
